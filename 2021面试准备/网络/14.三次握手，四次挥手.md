# 三次握手

**第一次握手**: 客户端发送syn标志位和**seq num**，向服务器申请建立连接，客户端状态由closed变为syn_send  

- seq num:TCP在传输数据时，如果数据比较大，会进行拆分操作，将大数据拆成一个个小的数据包。序号就是在这个时候用的。我们必须要知道这个包的顺序是什么，才能把真正的数据在服务端还原
- SYN:1

**第二次握手**: 服务端返回 syn和ack标志位，ack num以及seq num，确认第一次握手的报文段，返回ack num=seq num(第一次握手发送的)+1，同意建立连接，服务器状态由listen变为syn_received

- SYN:1 (因为还没建立连接),ACK是**对客户端发过来的序列号进行计算得到的**

**第三次握手**: 发送确认报文段，返回ack以及ack num=seq num(第二次握手发送的)+1，客户端状态变为：established(完成连接)

- ack。是**对第二次握手收到的序列号进行计算得到的**。用以告知已收到二次握手信息。
- 标志位。此时只需要ACK=1。SYN已经不需要了，双方已经同步完seq等信息。

# 为什么要三次

防止失效报文创建连接，

发送的报文可能会被互联中的网络设备阻塞，经过了一段时间才到达服务器，时间大于了RTO(Retransmission TimeOut)时间，导致客户端重发syc报文(重新创建新的连接，并丢失超时的连接)。如果只有两次握手，那么服务器每接收到syc报文(包括重发的syc报文)，就会创建多余的连接

# 四次挥手

