# JS执行顺序

JS代码是单线程的

代码可以分成两类

初始化代码

回调代码

 事件驱动模型，JS事件循环

由于JS是单线程的，但是浏览器内核是多线程的，所以在执行栈的代码会交给浏览器内核执行

首先执行初始化代码在stack中，遇到setTimeout等回调代码交给浏览器内核

浏览器内核将回调代码放入回调函数队列中

当初始化代码执行完后，轮询执行回调函数队列

﻿﻿<font color='orange'>`setTimeout`和`setInterval`的运行机制，是将指定的代码移出本轮事件循环，等到下一轮事件循环，再检查是否到了指定时间。如果到了，就执行对应的代码；如果不到，就继续等待。</font>

这意味着，`setTimeout`和`setInterval`指定的回调函数，必须等到本轮事件循环的所有同步任务都执行完，才会开始执行。由于前面的任务到底需要多少时间执行完，是不确定的，所以没有办法保证，`setTimeout`和`setInterval`指定的任务，一定会按照预定时间执行。

## setTimeout(f, 0)

`setTimeout`的作用是将代码推迟到指定时间执行，如果指定时间为`0`，即`setTimeout(f, 0)`，那么会立刻执行吗？

答案是不会。因为上一节说过，必须要等到当前脚本的同步任务，全部处理完以后，才会执行`setTimeout`指定的回调函数`f`。也就是说，`setTimeout(f, 0)`会在下一轮事件循环一开始就执行。

总之，`setTimeout(f, 0)`这种写法的目的是，尽可能早地执行`f`，但是并不能保证立刻就执行`f`。

### 最小延时

实际上，<font color='orange'>`setTimeout(f, 0)`不会真的在0毫秒之后运行，不同的浏览器有不同的实现</font>。以 Edge 浏览器为例，会等到4毫秒之后运行。如果电脑正在使用电池供电，会等到16毫秒之后运行；如果网页不在当前 Tab 页，会推迟到1000毫秒（1秒）之后运行。这样是为了节省系统资源。